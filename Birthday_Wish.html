<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Happy Birthday Chesong 🎈</title>
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Pacifico&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  :root {
    --accent1:#ff6fa3;
    --accent2:#ffd47f;
    --accent3:#8e24aa;
    --shadow:0 40px 100px rgba(142,36,170,0.08);
    font-family:"Inter",system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
  }
  *{box-sizing:border-box;}
  body{
    margin:0;
    background: linear-gradient(135deg,#f9ecff 0%,#ffe4f8 60%);
    background-size:220% 220%;
    animation: bgShift 22s ease-in-out infinite;
    color:#2f1f3a;
    min-height:100vh;
    overflow:hidden;
    position:relative;
  }
  /* subtle repeated name overlay */
  .name-pattern{
    position:absolute;
    inset:0;
    pointer-events:none;
    background:
      repeating-linear-gradient(135deg,
        rgba(255,255,255,0) 0,
        rgba(255,255,255,0) 40px,
        rgba(255,255,255,0.04) 40px,
        rgba(255,255,255,0.04) 80px
      );
    z-index:2;
  }
  .name-pattern:after{
    content:"Chesong Chesong Chesong";
    position:absolute;
    inset:0;
    font-size:140px;
    font-weight:800;
    font-family:"Pacifico",cursive;
    color:rgba(255,255,255,0.03);
    display:flex;
    justify-content:center;
    align-items:center;
    flex-wrap:wrap;
    gap:30px;
    transform:rotate(-12deg) scale(1.1);
    pointer-events:none;
    mix-blend-mode:overlay;
  }
  @keyframes bgShift{
    0%{background-position:15% 35%;}
    50%{background-position:85% 65%;}
    100%{background-position:15% 35%;}
  }
  h1{margin:0;font-weight:800;}
  p{margin:0;line-height:1.45;}
  button{cursor:pointer;border:none;outline:none;}

/* Countdown overlay */
  #intro-overlay{
    position:fixed;inset:0;
    background: rgba(255,248,253,0.97);
    backdrop-filter:blur(6px);
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    gap:20px;
    z-index:100;
    text-align:center;
    padding:0;
  }
  .floral-bg{position:absolute;inset:0;pointer-events:none;overflow:hidden;z-index:1;}
  .pulse-bg{
    position:absolute;
    width:320px;height:320px;
    border-radius:50%;
    background: radial-gradient(circle at 50% 50%, rgba(240,111,164,0.4), transparent 60%);
    filter:blur(35px);
    opacity:0;
    pointer-events:none;
    mix-blend-mode:overlay;
    z-index:2;
    transition: opacity .3s ease, transform .3s ease;
  }
  .countdown-big{
    font-size:140px;
    font-weight:800;
    margin:0;
    line-height:1;
    letter-spacing:1.5px;
    color: var(--accent3);
    text-shadow:0 25px 70px rgba(142,36,170,0.5);
    transition: transform .3s ease, opacity .3s ease;
  }

  /* Surprise screen */
  #surprise-screen{
    position:fixed;
    inset:0;
    background: linear-gradient(135deg,#ffe4f8 0%,#f3e8ff 60%);
    backdrop-filter: blur(3px);
    display:none;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    gap:30px;
    z-index:105;
    text-align:center;
    padding:20px;
    overflow:hidden;
  }
  .bokeh{
    position:absolute;
    border-radius:50%;
    filter:blur(60px);
    opacity:0.35;
    mix-blend-mode:overlay;
    animation: drift 30s infinite alternate ease-in-out;
  }
  @keyframes drift{
    from{transform:translate(0,0) scale(1);}
    to{transform:translate(40px,-30px) scale(1.1);}
  }
  #surprise-screen h2{
    font-size:5rem;
    margin:0;
    font-weight:700;
    font-family:"Dancing Script",cursive;
    background: linear-gradient(135deg,var(--accent1),var(--accent2));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    position:relative;
    text-shadow:0 8px 30px rgba(255,200,255,0.4);
  }
  .sparkle{
    position:absolute;
    width:10px;
    height:10px;
    background: radial-gradient(circle at 50% 50%, #fff, rgba(255,255,255,0));
    border-radius:50%;
    opacity:0.7;
    animation: sparkle-float 4s infinite ease-in-out;
  }
  @keyframes sparkle-float{
    0%{transform:translateY(0) scale(1);}
    50%{transform:translateY(-10px) scale(1.2);}
    100%{transform:translateY(0) scale(1);}
  }

  .birthday-box{
    background: linear-gradient(135deg,#ffecf9,#ffe4f1);
    padding:25px 40px;
    border-radius:18px;
    position:relative;
    box-shadow:0 35px 110px rgba(142,36,170,0.15);
    cursor:pointer;
    font-weight:700;
    font-size:1.3rem;
    color:#8e24aa;
    display:flex;
    align-items:center;
    gap:16px;
    transition:transform .25s ease, box-shadow .25s ease;
    font-family:"Inter",system-ui;
  }
  .birthday-box:hover { transform:scale(1.05); box-shadow:0 45px 140px rgba(142,36,170,0.25);}
  .birthday-box .gift-icon{
    width:38px;
    height:38px;
    display:inline-flex;
    justify-content:center;
    align-items:center;
    background:#fff;
    border-radius:50%;
    box-shadow:0 10px 40px rgba(255,111,164,0.3);
    font-size:22px;
    color:var(--accent3);
  }

  /* Popup from box */
  #box-popup{
    position:fixed;
    inset:0;
    display:flex;
    flex-direction:column;
    justify-content:flex-start;
    align-items:center;
    gap:16px;
    background: rgba(0,0,0,0.24);
    backdrop-filter: blur(4px);
    z-index:120;
    text-align:center;
    padding:20px;
    opacity:0;
    pointer-events:none;
    transition:opacity .35s ease;
  }
  #box-popup.show{
    opacity:1;
    pointer-events:auto;
  }
  #box-popup .popup-text{
    font-size:5rem;
    font-weight:800;
    margin:0;
    line-height:1.05;
    background: linear-gradient(135deg,#ffe47f,#ff6fa3,#d48eff);
    background-size:300% 100%;
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
    position:relative;
    text-shadow:
      0 8px 40px rgba(255,255,255,0.6),
      0 6px 30px rgba(142,36,170,0.5);
    animation: shimmer 4s linear infinite;
    font-family:"Dancing Script",cursive;
    text-align:center;
    transform: translateY(-15px);
  }
  @keyframes shimmer{
    0%{background-position:0%;}
    100%{background-position:100%;}
  }
  .popup-decor{
    position:relative;
    width:320px;
    height:320px;
    pointer-events:none;
  }

  /* Slideshow memory */
  #slideshow {
    position:fixed;
    inset:0;
    background: rgba(255,255,255,0.95);
    backdrop-filter: blur(6px);
    z-index:115;
    display:none;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    gap:20px;
    padding:30px;
    text-align:center;
  }
  .slide-container{
    position:relative;
    width:360px;
    height:460px;
    background:#fff;
    border-radius:22px;
    box-shadow:0 60px 140px rgba(142,36,170,0.08);
    overflow:hidden;
    display:flex;
    flex-direction:column;
    align-items:center;
    padding:16px;
    font-family:"Inter",system-ui;
  }
  .slide-photo{
    flex:1;
    width:100%;
    border-radius:14px;
    overflow:hidden;
    margin-bottom:12px;
    background:#f7ecfb;
  }
  .slide-photo img{
    width:100%;
    height:100%;
    object-fit:cover;
    display:block;
    border-radius:12px;
  }
  .slide-caption{
    font-size:1rem;
    font-weight:600;
    color:#5f4a71;
    margin-top:4px;
  }
  .slide-controls{
    margin-top:12px;
    display:flex;
    gap:12px;
  }
  .small-btn{
    padding:8px 14px;
    border-radius:999px;
    background: var(--accent1);
    color:#fff;
    font-size:.8rem;
    cursor:pointer;
    border:none;
  }

  /* Cake */
  .cake-wrapper{
    position:fixed;
    inset:0;
    display:none;
    z-index:115;
    justify-content:center;
    align-items:center;
    background:rgba(0,0,0,0.15);
    flex-direction:column;
    gap:24px;
    padding:20px;
  }
  .cake{
    position:relative;
    width:220px;
    height:180px;
    perspective:600px;
    transform-style:preserve-3d;
    animation: rotateCake 12s linear infinite;
  }
  @keyframes rotateCake{
    0%{transform: rotateY(0deg);}
    100%{transform: rotateY(360deg);}
  }
  .layer{
    position:absolute;
    left:50%;
    transform:translateX(-50%);
    border-radius:50%;
    background: linear-gradient(135deg,#ffd9f0,#ffb4d9);
    box-shadow:0 35px 120px rgba(216,95,165,0.3);
  }
  .layer.bottom{
    width:200px;
    height:80px;
    top:70px;
  }
  .layer.top{
    width:160px;
    height:60px;
    top:40px;
    background: linear-gradient(135deg,#ffe4fb,#ffccf2);
  }
  .candles{
    position:absolute;
    top:0;
    left:50%;
    transform:translateX(-50%);
    display:flex;
    gap:12px;
  }
  .candle{
    position:relative;
    width:12px;
    height:40px;
    background:#ffffff;
    border-radius:4px;
    display:flex;
    justify-content:center;
    align-items:flex-start;
    box-shadow:0 10px 30px rgba(255,255,255,0.5);
  }
  .flame{
    position:absolute;
    top:-12px;
    left:50%;
    transform:translateX(-50%);
    width:12px;
    height:18px;
    border-radius:50% 50% 30% 30%;
    background: radial-gradient(circle at 50% 40%, #ffe47f, #ff9ede 60%);
    filter:drop-shadow(0 15px 40px rgba(255,214,179,0.7));
    animation: flicker 0.35s infinite alternate;
  }
  @keyframes flicker{
    0%{transform:translateX(-50%) scale(1);}
    100%{transform:translateX(-50%) scale(0.9);}
  }
  .blown .flame{
    opacity:0;
    transition:opacity .8s ease;
  }

  /* Balloons */
  #balloon-area{
    position:fixed;
    inset:0;
    pointer-events:none;
    overflow:hidden;
    z-index:50;
  }
  .balloon{
    position:absolute;
    bottom:-20px;
    transform:translateX(-50%);
    animation: floatUp 6s linear forwards;
    font-size:14px;
    color:white;
    padding:10px;
    border-radius:50%;
    width:110px;
    height:140px;
    display:flex;
    align-items:center;
    justify-content:center;
    box-shadow:0 8px 25px rgba(0,0,0,0.15);
    text-align:center;
    word-wrap:break-word;
    cursor:pointer;
    pointer-events:auto;
  }
  @keyframes floatUp{0%{transform:translateX(-50%) translateY(0);opacity:1;}100%{transform:translateX(-50%) translateY(-700px);opacity:0;}}
  .surprise-balloon{
    position:absolute;
    bottom:-20px;
    transform:translateX(-50%);
    animation: floatUpSurprise 7s ease-in forwards;
    font-size:16px;
    color:white;
    padding:12px;
    border-radius:50%;
    width:100px;
    height:130px;
    display:flex;
    align-items:center;
    justify-content:center;
    box-shadow:0 12px 35px rgba(0,0,0,0.2);
    text-align:center;
    word-wrap:break-word;
  }
  @keyframes floatUpSurprise{
    0%{transform:translateX(-50%) translateY(0);opacity:1;}
    100%{transform:translateX(-50%) translateY(-800px);opacity:0;}
  }

  /* Memory cards */
  .memory-container{
    position:fixed;
    inset:0;
    pointer-events:none;
    z-index:12;
  }
  .envelope{
    position:absolute;
    width:50px;
    height:40px;
    background: linear-gradient(135deg,#ffe4f8,#ffd1f0);
    border-radius:8px;
    box-shadow:0 20px 80px rgba(142,36,170,0.1);
    display:flex;
    justify-content:center;
    align-items:center;
    cursor:pointer;
    transition:transform .3s ease;
    pointer-events:auto;
  }
  .envelope:hover{transform:scale(1.1);}
  .card-popup{
    position:fixed;
    inset:0;
    background:rgba(255,255,255,0.95);
    backdrop-filter:blur(7px);
    display:none;
    z-index:130;
    justify-content:center;
    align-items:center;
    padding:20px;
  }
  .card-inner{
    background:#fff;
    padding:24px;
    border-radius:18px;
    max-width:500px;
    box-shadow:0 80px 220px rgba(142,36,170,0.14);
    position:relative;
    font-family:"Inter",system-ui;
    text-align:center;
  }
  .close-card{
    position:absolute;
    top:10px;
    right:10px;
    background:rgba(142,36,170,0.1);
    border-radius:50%;
    width:32px;
    height:32px;
    display:flex;
    justify-content:center;
    align-items:center;
    font-weight:600;
    cursor:pointer;
  }

  /* Fireworks canvas (intense) */
  #fireworks-canvas{
    position:fixed;
    inset:0;
    pointer-events:none;
    z-index:40;
  }
  .confetto{
    position:fixed;
    width:8px;height:8px;
    border-radius:50%;
    pointer-events:none;
    mix-blend-mode:screen;
    animation: confetti-fall 1s ease-out forwards;
  }
  @keyframes confetti-fall{
    0%{transform:translateY(0) scale(1);opacity:1;}
    100%{transform:translateY(120px) scale(0.6);opacity:0;}
  }

  /* Main content */
  .container{max-width:1050px;margin:0 auto;padding:3rem 1rem 5rem;position:relative;z-index:10;opacity:0;transition:opacity .8s ease;pointer-events:none;}
  .hero{display:flex;flex-wrap:wrap;gap:1.5rem;align-items:center;background:white;border-radius:28px;padding:2.5rem;box-shadow: var(--shadow);position:relative;overflow:hidden;transform: translateY(30px);opacity:0;transition: transform .8s ease, opacity .9s ease;}
  .hero.visible{transform:translateY(0);opacity:1;}
  .hero .text{flex:1 1 350px;min-width:250px;}
  .hero .text h1{font-size:2.6rem;margin-bottom:8px;}
  .hero .text p{font-size:1.05rem;margin-bottom:12px;color:#5f4a71;}
  .music-controls{display:flex;align-items:center;gap:0.6rem;margin-top:8px;font-size:.9rem;}
  .btn2{padding:.65rem 1rem;border:none;border-radius:999px;cursor:pointer;font-weight:600;font-size:.9rem;background: var(--accent1);color:#fff;transition:all .35s cubic-bezier(.25,.8,.25,1);}
  .btn2:hover{filter:brightness(1.07);}
  .photo-wrapper{position:relative;width:260px;height:260px;flex:0 0 260px;display:flex;justify-content:center;align-items:center;}
  .photo-circle{position:relative;width:260px;height:260px;border-radius:50%;overflow:hidden;border:6px solid rgba(240,111,164,0.5);background: radial-gradient(circle at 30% 30%, #ffe4f8, #f9e1fc);display:flex;justify-content:center;align-items:center;cursor:default;box-shadow:0 40px 90px rgba(240,111,164,0.15);transition:transform .35s ease;}
  .photo-circle img{width:100%;height:100%;object-fit:cover;display:block;border-radius:50%;}
  .message-box{background: rgba(255,240,250,0.95);padding:1.9rem;border-radius:22px;margin-top:2.5rem;position:relative;box-shadow:0 50px 120px rgba(142,36,170,0.08);font-size:1rem;line-height:1.5;transform:translateY(30px);opacity:0;transition:transform .9s ease, opacity .9s ease;}
  .message-box.visible{transform:translateY(0);opacity:1;}
  .message-box blockquote{margin:0;font-size:1.18rem;line-height:1.5;position:relative;padding-left:1rem;color:#5f4a71;}
  .message-box blockquote:before{content:"“";font-size:3.8rem;position:absolute;left:-5px;top:-12px;color:#b36ebf;font-family:serif;}
  .signature{margin-top:1rem;font-weight:600;text-align:right;font-size:1rem;color:#4a216d;}
  footer{margin-top:4rem;text-align:center;font-size:.75rem;color:#6a5a7b;}
</style>
</head>
<body>

  <!-- Name pattern overlays -->
  <div class="name-pattern"></div>

  <!-- Countdown overlay -->
  <div id="intro-overlay">
    <div class="floral-bg" id="floral-bg"></div>
    <div class="pulse-bg" id="pulse-bg"></div>
    <div class="countdown-wrapper">
      <p class="countdown-big" id="big-number">3</p>
    </div>
  </div>

  <!-- Surprise after countdown -->
  <div id="surprise-screen">
    <div class="bokeh" style="width:260px;height:260px;top:10%;left:15%;background:rgba(255,230,255,0.6);"></div>
    <div class="bokeh" style="width:180px;height:180px;top:30%;right:10%;background:rgba(255,210,245,0.5);animation-duration:24s;"></div>
    <div class="bokeh" style="width:320px;height:320px;bottom:5%;left:40%;background:rgba(250,230,255,0.4);animation-duration:32s;"></div>
    <h2>Surprise!</h2>
    <div class="sparkle" style="top:calc(50% - 120px);left:50%;width:14px;height:14px;"></div>
    <div class="sparkle" style="top:calc(50% - 100px);left:42%;width:10px;height:10px;animation-delay:.7s;"></div>
    <div class="sparkle" style="top:calc(50% - 105px);left:58%;width:12px;height:12px;animation-delay:1.2s;"></div>
    <div class="birthday-box" id="birthday-box">
      <div class="gift-icon">🎁</div>
      <div>Click me</div>
    </div>
    <div id="surprise-balloons-container"></div>
  </div>

  <!-- Popup from box -->
  <div id="box-popup">
    <div class="popup-decor" id="popup-decor"></div>
    <div class="popup-text">Happy Birthday Chesong!</div>
  </div>

  <!-- Slideshow memory (after popup) -->
  <div id="slideshow">
    <div class="slide-container" id="slide-container">
      <div class="slide-photo" id="slide-photo"><img src="" alt="memory"></div>
      <div class="slide-caption" id="slide-caption">Cherished moment</div>
      <div class="slide-controls">
        <button class="small-btn" id="prev-slide">Previous</button>
        <button class="small-btn" id="next-slide">Next</button>
        <button class="small-btn" id="done-slideshow">Done</button>
      </div>
    </div>
  </div>

  <!-- Cake -->
  <div class="cake-wrapper" id="cake-wrapper">
    <div class="cake" id="cake">
      <div class="layer bottom"></div>
      <div class="layer top"></div>
      <div class="candles">
        <div class="candle"><div class="flame"></div></div>
        <div class="candle"><div class="flame"></div></div>
        <div class="candle"><div class="flame"></div></div>
      </div>
    </div>
    <div style="font-family:'Dancing Script',cursive;font-size:1.4rem;color:#8e24aa;">Make a wish, Chesong!</div>
  </div>

  <!-- Balloons & fireworks -->
  <div id="balloon-area"></div>
  <canvas id="fireworks-canvas"></canvas>

  <!-- Memory envelopes -->
  <div class="memory-container" id="memory-container"></div>
  <div class="card-popup" id="card-popup">
    <div class="card-inner">
      <div class="close-card" id="close-card">&times;</div>
      <div id="card-content">
        <h2 style="margin-top:0;">Memory</h2>
        <p>This is one of our favorite moments.</p>
        <!-- could include image -->
      </div>
    </div>
  </div>

  <!-- Main content -->
  <div class="container" id="main-content">
    <div class="hero" id="hero">
      <div class="text">
        <h1>Happy Birthday, Chesong! 🎉</h1>
        <p>Today is all about celebrating your light, laughter, and the beautiful bond we share. Bestie, here’s to more memories that bloom like flowers.</p>
        <div class="music-controls">
          <button class="btn2" onclick="toggleMusic()">Play / Pause Music</button>
          <span id="music-label">Your song goes here</span>
        </div>
      </div>
      <div class="photo-wrapper" id="hero-photo">
        <div class="photo-circle">
          <img src="" alt="Chesong" id="persisted-img">
        </div>
      </div>
    </div>

    <div class="message-box" id="message-box">
      <blockquote>
        Happy Birthday, Chesong! You’re more than a friend—you’re family. Thank you for bringing color, kindness, and happiness wherever you go. Wishing you endless smiles, good health, and all the success you deserve.
      </blockquote>
      <div class="signature">— Your Bestie 💙</div>
    </div>

    <footer>
      Customize this page: replace the photo URL or swap in your favorite background music.
    </footer>
  </div>

  <!-- Gift box -->
  <div class="gift-container-main" id="gift-box-main">
    <div class="gift-main">
      <div class="ribbon-main">
        <div class="vert"></div>
        <div class="horiz"></div>
      </div>
    </div>
  </div>
  <div class="gift-message-main" id="gift-message-main">
    Surprise! You’re one of the brightest stars in my life. 💖
  </div>

  <!-- Pop sound -->
  <audio id="popSound" src="pop.mp3" preload="auto"></audio>

  <script>
    // persistent photo
    const defaultImageSrc = "";
    const storageKey = "chesongPhotoSrc";
    const persistedImg = document.getElementById("persisted-img");
    function loadPhoto(){
      const stored = localStorage.getItem(storageKey);
      const src = stored || defaultImageSrc;
      if(src){ persistedImg.src = src; }
    }
    loadPhoto();
    window.setChesongPhoto = function(newSrc){
      if(!newSrc) return;
      persistedImg.src=newSrc;
      localStorage.setItem(storageKey,newSrc);
    };

    // Flower for countdown and popup
    const floralBg = document.getElementById("floral-bg");
    function createFlower(x,y,scale=1,delay=0){
      const flower=document.createElement("div");
      flower.style.position="absolute";
      flower.style.left=x+"%";
      flower.style.top=y+"%";
      flower.style.transform=`scale(${scale}) translate(-50%,-50%)`;
      flower.style.opacity=0;
      flower.style.pointerEvents="none";
      for(let i=0;i<5;i++){
        const petal=document.createElement("div");
        petal.style.position="absolute";
        petal.style.width="12px";
        petal.style.height="24px";
        petal.style.background="radial-gradient(circle at 50% 30%, #ffe0f8 0%, #ffb4ed 70%)";
        petal.style.borderRadius="50% 50% 45% 45%";
        petal.style.filter="drop-shadow(0 6px 15px rgba(255,150,220,0.4))";
        const angle=(i/5)*Math.PI*2;
        petal.style.transform=`rotate(${(angle*180/Math.PI)}deg) translate(0,-12px)`;
        flower.appendChild(petal);
      }
      const center=document.createElement("div");
      center.style.position="absolute";
      center.style.top="50%";
      center.style.left="50%";
      center.style.width="10px";
      center.style.height="10px";
      center.style.background="radial-gradient(circle at 50% 50%, #ffe49f,#f8c66b)";
      center.style.borderRadius="50%";
      center.style.transform="translate(-50%,-50%)";
      center.style.boxShadow="0 0 20px rgba(255,230,190,0.6)";
      flower.appendChild(center);
      floralBg.appendChild(flower);
      setTimeout(()=>{
        flower.animate([
          {opacity:0, transform:`scale(${scale*0.6}) translate(-50%,-50%)`},
          {opacity:1, transform:`scale(${scale}) translate(-50%,-50%)`}
        ],{duration:700,easing:"cubic-bezier(.25,.8,.25,1)"});
        flower.style.opacity=1;
      },delay);
      function floatAnim(){
        const dx=(Math.random()-0.5)*10;
        const dy=(Math.random()-0.5)*10;
        flower.animate([
          {transform:`translate(${dx}px, ${dy}px) scale(${scale})`},
          {transform:`translate(${-dx}px, ${-dy}px) scale(${scale})`}
        ],{duration:6000+Math.random()*2000,direction:"alternate",iterations:Infinity,easing:"ease-in-out"});
      }
      floatAnim();
    }
    for(let i=0;i<14;i++){
      createFlower(Math.random()*100, Math.random()*100, 0.6+Math.random()*0.8, i*120);
    }

    // Countdown -> surprise
    const bigNumberEl = document.getElementById("big-number");
    const pulseBg = document.getElementById("pulse-bg");
    const intro = document.getElementById("intro-overlay");
    const surprise = document.getElementById("surprise-screen");
    const birthdayBox = document.getElementById("birthday-box");
    const boxPopup = document.getElementById("box-popup");
    const mainContent = document.getElementById("main-content");
    const hero = document.getElementById("hero");
    const messageBox = document.getElementById("message-box");
    const slideshow = document.getElementById("slideshow");
    const cakeWrapper = document.getElementById("cake-wrapper");

    function flashPulse(){
      pulseBg.style.opacity=1;
      pulseBg.style.transform="scale(1)";
      setTimeout(()=>{
        pulseBg.style.transition="opacity .3s ease, transform .3s ease";
        pulseBg.style.opacity=0;
        pulseBg.style.transform="scale(1.6)";
      },60);
      setTimeout(()=>{
        pulseBg.style.transition="";
        pulseBg.style.transform="scale(1)";
      },800);
    }
    function animateNumber(num){
      bigNumberEl.textContent=num;
      bigNumberEl.style.transform="scale(1.4)";
      bigNumberEl.style.opacity=1;
      setTimeout(()=>{
        bigNumberEl.style.transition="transform .4s ease";
        bigNumberEl.style.transform="scale(1)";
      },150);
      flashPulse();
    }
    async function startFlow(){
      for(const n of [3,2,1]){
        animateNumber(n);
        await new Promise(r=>setTimeout(r,1200));
      }
      bigNumberEl.style.opacity=0;
      intro.style.display="none";
      surprise.style.display="flex";
      startSurpriseBalloons();
    }
    document.addEventListener("DOMContentLoaded", ()=>{ startFlow(); });

    // Surprise balloons
    function startSurpriseBalloons(){
      const container=document.getElementById("surprise-balloons-container");
      function spawn(){
        const b=document.createElement("div");
        b.className="surprise-balloon";
        const colors=['#ff6f91','#ffcc70','#6a67ce','#8deaff','#ff9ff3','#c56cf0','#ffadad'];
        b.style.backgroundColor=colors[Math.floor(Math.random()*colors.length)];
        const msg=["😊","💖","🎉","✨","🌸","Chesong!"][Math.floor(Math.random()*6)];
        b.innerText=msg;
        const leftPercent = Math.random() * 100;
        b.style.left = leftPercent + "%";
        container.appendChild(b);
        const swayAmp = 10 + Math.random()*6;
        const swaySpeed = 0.002 + Math.random()*0.001;
        let startTime = performance.now();
        function sway(now){
          const delta = now - startTime;
          const offset = Math.sin(delta * swaySpeed) * swayAmp;
          b.style.transform = `translateX(calc(-50% + ${offset}px))`;
          requestAnimationFrame(sway);
        }
        requestAnimationFrame(sway);
        setTimeout(()=>{ b.remove(); },7000);
      }
      spawn();
      const interval = setInterval(()=>{
        if(getComputedStyle(surprise).display !== "flex"){
          clearInterval(interval);
          return;
        }
        spawn();
      },900);
    }

    // On birthday-box click: show flowers, cake, big fireworks, then slideshow -> main
    birthdayBox.addEventListener("click", async ()=>{
      surprise.style.display="none";
      showBoxPopup();
    });

    // Big fireworks show for 5s
    let intenseFireworksTimeout;
    function startIntenseFireworks(){
      intenseFireworksTimeout && clearTimeout(intenseFireworksTimeout);
      const start = Date.now();
      function burstLoop(){
        const now = Date.now();
        if(now - start >= 5000) return;
        for(let i=0;i<3;i++){
          const x = Math.random()*window.innerWidth;
          const y = Math.random()*window.innerHeight/2;
          launchFirework(x,y);
        }
        requestAnimationFrame(burstLoop);
      }
      burstLoop();
    }

    // popup sequence
    function spawnPetals(){
      for(let i=0;i<25;i++){
        const petal=document.createElement("div");
        petal.className="petal";
        const startX = window.innerWidth/2 + (Math.random()*160 - 80);
        const startY = window.innerHeight/2 + (Math.random()*40 - 20);
        petal.style.left = startX + "px";
        petal.style.top = startY + "px";
        document.body.appendChild(petal);
        setTimeout(()=>{ petal.remove(); }, 3000 + Math.random()*800);
      }
    }

    function showBoxPopup(){
      // flower burst
      for(let i=0;i<10;i++){
        createFlower(50 + (Math.random()-0.5)*40, 40 + (Math.random()-0.5)*30, 0.8 + Math.random()*0.5, i*60);
      }
      spawnPetals();
      for(let i=0;i<5;i++){
        const wishes=["Wishing you joy! 🎉","Shine bright! ✨","Stay awesome 💖","Forever bestie 💫"];
        createBalloon(wishes[Math.floor(Math.random()*wishes.length)]);
      }
      boxPopup.classList.add("show");
      spawnMiniConfetti(window.innerWidth/2, window.innerHeight/2);
      startIntenseFireworks();

      // after 5s, hide popup, show cake, then slideshow, then main
      setTimeout(()=>{
        boxPopup.classList.remove("show");
        // show cake briefly
        cakeWrapper.style.display="flex";
        // extinguish candles after 3s
        setTimeout(()=>{
          document.querySelectorAll(".candle").forEach(c=>c.classList.add("blown"));
        },2500);
        // after cake display, show slideshow
        setTimeout(()=>{
          cakeWrapper.style.display="none";
          startSlideshow();
        },5000);
      },5000);
    }

    // Slideshow data (example placeholders)
    const slides = [
      {src:"https://via.placeholder.com/360x460?text=Memory+1", caption:"Our first adventure"},
      {src:"https://via.placeholder.com/360x460?text=Memory+2", caption:"Laughs and secrets"},
      {src:"https://via.placeholder.com/360x460?text=Memory+3", caption:"Forever besties"},
    ];
    let slideIndex=0;
    const slidePhoto = document.getElementById("slide-photo").querySelector("img");
    const slideCaption = document.getElementById("slide-caption");
    function renderSlide(){
      slidePhoto.src=slides[slideIndex].src;
      slideCaption.textContent=slides[slideIndex].caption;
    }
    document.getElementById("prev-slide").addEventListener("click", ()=>{
      slideIndex=(slideIndex-1+slides.length)%slides.length;
      renderSlide();
    });
    document.getElementById("next-slide").addEventListener("click", ()=>{
      slideIndex=(slideIndex+1)%slides.length;
      renderSlide();
    });
    document.getElementById("done-slideshow").addEventListener("click", ()=>{
      slideshow.style.display="none";
      revealMain();
    });
    function startSlideshow(){
      renderSlide();
      slideshow.style.display="flex";
    }

    function revealMain(){
      mainContent.style.opacity="1";
      mainContent.style.pointerEvents="auto";
      hero.classList.add("visible");
      messageBox.classList.add("visible");
    }

    // Fireworks core
    const fwCanvas = document.getElementById("fireworks-canvas");
    const fwCtx = fwCanvas.getContext("2d");
    function resizeFW(){ fwCanvas.width=window.innerWidth; fwCanvas.height=window.innerHeight; }
    window.addEventListener("resize", resizeFW);
    resizeFW();
    class FireParticle{
      constructor(x,y,color){
        this.x=x; this.y=y;
        const angle=Math.random()*Math.PI*2;
        const speed=Math.random()*3+2;
        this.vx=Math.cos(angle)*speed;
        this.vy=Math.sin(angle)*speed;
        this.alpha=1;
        this.color=color;
        this.size=2+Math.random()*3;
      }
      update(){
        this.x+=this.vx;
        this.y+=this.vy;
        this.vy+=0.05;
        this.alpha-=0.02;
      }
      draw(){
        if(this.alpha<=0) return;
        fwCtx.globalAlpha=this.alpha;
        fwCtx.fillStyle=this.color;
        fwCtx.beginPath();
        fwCtx.arc(this.x,this.y,this.size,0,Math.PI*2);
        fwCtx.fill();
      }
    }
    let fireworks=[];
    function launchFirework(x,y){
      const palette=["#ffda7b","#ff9ede","#a0c4ff","#d1f5d3","#f8d49d","#c56cf0"];
      for(let i=0;i<80;i++){
        const c=palette[Math.floor(Math.random()*palette.length)];
        fireworks.push(new FireParticle(x,y,c));
      }
    }
    function animateFW(){
      fwCtx.clearRect(0,0,fwCanvas.width,fwCanvas.height);
      for(let i=fireworks.length-1;i>=0;i--){
        fireworks[i].update();
        fireworks[i].draw();
        if(fireworks[i].alpha<=0) fireworks.splice(i,1);
      }
      requestAnimationFrame(animateFW);
    }
    animateFW();
    function pointerHandler(e){
      const x = e.touches ? e.touches[0].clientX : e.clientX;
      const y = e.touches ? e.touches[0].clientY : e.clientY;
      launchFirework(x,y);
    }
    document.addEventListener("click", pointerHandler);
    document.addEventListener("touchstart", pointerHandler);

    // Global balloons with name occasionally
    const balloonArea=document.getElementById("balloon-area");
    const wishes=[
      "Wishing you joy! 🎉",
      "Shine bright! ✨",
      "Stay awesome 💖",
      "Cheers to you 🥂",
      "Forever bestie 💫",
      "Smile always 😄",
      "Chesong, you’re loved 💐",
      "Hugs & laughs 🤗"
    ];
    function createBalloon(msg){
      const b=document.createElement("div");
      b.className="balloon";
      b.innerText=msg;
      const colors=['#ff6f91','#ffcc70','#6a67ce','#8deaff','#ff9ff3','#c56cf0','#ffadad'];
      b.style.backgroundColor=colors[Math.floor(Math.random()*colors.length)];
      const basePercent = Math.random() * 100;
      b.style.left = basePercent + "%";
      balloonArea.appendChild(b);
      // horizontal sway
      const swayAmplitude = 10 + Math.random()*8;
      const swaySpeed = 0.002 + Math.random()*0.001;
      let start = performance.now();
      function sway(now){
        const delta = now - start;
        const offset = Math.sin(delta * swaySpeed) * swayAmplitude;
        b.style.transform = `translateX(calc(-50% + ${offset}px))`;
        requestAnimationFrame(sway);
      }
      requestAnimationFrame(sway);
      b.addEventListener("click",(e)=>{
        e.stopPropagation();
        showTooltip("You're awesome!", e.clientX, e.clientY);
        spawnMiniConfetti(e.clientX,e.clientY);
      });
      setTimeout(()=>{
        const pop=document.getElementById("popSound");
        pop.currentTime=0;
        pop.play().catch(()=>{});
        b.remove();
      },6000);
    }
    setInterval(()=>{
      const w=wishes[Math.floor(Math.random()*wishes.length)];
      createBalloon(w);
    },1400);

    // Sparkle cursor trail
    document.addEventListener("mousemove",(e)=>{
      const s=document.createElement("div");
      s.style.position="fixed";
      s.style.left=e.clientX + "px";
      s.style.top=e.clientY + "px";
      s.style.width="8px";
      s.style.height="8px";
      s.style.borderRadius="50%";
      s.style.pointerEvents="none";
      s.style.background="radial-gradient(circle at 50% 50%, #fff, rgba(255,255,255,0))";
      s.style.mixBlendMode="screen";
      s.style.opacity="1";
      s.style.transform="translate(-50%,-50%) scale(1)";
      s.style.transition="opacity .6s ease, transform .6s ease";
      document.body.appendChild(s);
      requestAnimationFrame(()=>{
        s.style.opacity="0";
        s.style.transform="translate(-50%,-50%) scale(1.5)";
      });
      setTimeout(()=>s.remove(), 700);
    });

    // Tooltip & mini confetti
    function showTooltip(text,x,y){
      const tt=document.createElement("div");
      tt.style.position="fixed";
      tt.style.left=x+"px";
      tt.style.top=y+"px";
      tt.style.background="rgba(255,255,255,0.95)";
      tt.style.padding="8px 12px";
      tt.style.borderRadius="8px";
      tt.style.fontSize=".75rem";
      tt.style.boxShadow="0 20px 60px rgba(142,36,170,0.12)";
      tt.style.transform="translate(-50%,-120%)";
      tt.style.whiteSpace="nowrap";
      tt.textContent=text;
      document.body.appendChild(tt);
      setTimeout(()=>{ tt.style.opacity="0"; },1200);
      setTimeout(()=>{ tt.remove(); },1800);
    }
    function spawnMiniConfetti(x,y){
      for(let i=0;i<12;i++){
        const dot=document.createElement("div");
        dot.className="confetto";
        dot.style.background=['#ffda7b','#ff6fa91','#8deaff','#c56cf0'][Math.floor(Math.random()*4)];
        dot.style.left=x + (Math.random()*40-20) + "px";
        dot.style.top=y + (Math.random()*10-5) + "px";
        document.body.appendChild(dot);
        setTimeout(()=>{ dot.remove(); },1000);
      }
    }

    // Memory envelope generator
    const memoryContainer = document.getElementById("memory-container");
    const cardPopup = document.getElementById("card-popup");
    const closeCard = document.getElementById("close-card");
    const cardContent = document.getElementById("card-content");
    // sample memory messages
    const memories = [
      {text:"Remember our first movie night? 🎬", img:""},
      {text:"Laughing till dawn on the terrace.", img:""},
      {text:"Late-night talks and dreams.", img:""}
    ];
    function placeMemoryEnvelopes(){
      for(let i=0;i<5;i++){
        const env=document.createElement("div");
        env.className="envelope";
        env.style.left=(10 + Math.random()*80)+"%";
        env.style.top=(20 + Math.random()*60)+"%";
        // pick random memory
        const mem=memories[Math.floor(Math.random()*memories.length)];
        env.addEventListener("click",(e)=>{
          e.stopPropagation();
          cardContent.innerHTML = `<h2>Memory</h2><p>${mem.text}</p>`;
          cardPopup.style.display="flex";
        });
        memoryContainer.appendChild(env);
      }
    }
    placeMemoryEnvelopes();
    closeCard.addEventListener("click", ()=>{ cardPopup.style.display="none"; });

    // Gift box
    const giftMain=document.getElementById("gift-box-main");
    const giftMsgMain=document.getElementById("gift-message-main");
    let openMain=false;
    giftMain.addEventListener("click",(e)=>{
      e.stopPropagation();
      if(openMain) return;
      openMain=true;
      giftMain.querySelector(".gift-main").style.transform="scale(1.08)";
      launchFirework(80, window.innerHeight - 120);
      setTimeout(()=>{ giftMsgMain.style.opacity="1"; },300);
      setTimeout(()=>{
        giftMsgMain.style.opacity="0";
        giftMain.querySelector(".gift-main").style.transform="";
        openMain=false;
      },5000);
    });

    // Music placeholder
    function toggleMusic(){
      const label=document.getElementById("music-label");
      label.textContent="(no track loaded)";
    }
  </script>
</body>
</html>
